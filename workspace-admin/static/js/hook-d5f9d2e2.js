import{_ as M}from"./form.vue_vue_type_script_setup_true_lang-a2e9a32a.js";import{aF as l,r,S as R,h as T,az as a,aG as q,ab as x,aH as F}from"./index-e18d8825.js";import{getColumns as v,formConfigs as N}from"./config-ecbb22d3.js";import{o as P}from"./orgList-6a75d374.js";import"./TitleCate-3b5df917.js";const _=n=>l.request("post","/config/kingdee",{data:n}),K=n=>l.request("post","/config/kingdee/insertkingdee",{data:n}),$=n=>l.request("post","/config/kingdee/updatekingdee",{data:n}),j=n=>l.request("post","/config/kingdee/deletekingdee",{data:n});function Q(){const n=r(),m=r(),g=r(!0),f=r([]),p=r([]),h=r([]),o=R({total:0,pageSize:10,currentPage:1,background:!0});T(()=>{S()});function k(t){}function b(t){}function D(t){}async function u(){try{g.value=!0;const e=(await _(m.value)).data;h.value=e,o.total=e.length,o.pageSize=100,o.currentPage=1,g.value=!1}catch(t){a.error(t.toString()||"列表获取失败")}}async function S(){var t;try{const s=(t=(await P({})).data)==null?void 0:t.map(({id:i,orgName:d})=>({value:i,label:d}));p.value=s,f.value=v(s)}catch(e){f.value=v([]),a.error(e.toString()||"组织列表获取失败")}}const y=t=>{t&&(t.resetFields(),u())};async function C(t,e){try{const i={add:"添加",edit:"编辑"}[t],d={id:(e==null?void 0:e.id)??"",accountName:(e==null?void 0:e.accountName)??"",ipAddress:(e==null?void 0:e.ipAddress)??"",linkDbName:(e==null?void 0:e.linkDbName)??"",dbType:(e==null?void 0:e.dbType)??"",username:(e==null?void 0:e.username)??"",password:(e==null?void 0:e.password)??"",nick:(e==null?void 0:e.nick)??"",accountStatus:(e==null?void 0:e.accountStatus)??"",orgId:(e==null?void 0:e.orgId)??""};q({title:`${i}数据库`,props:{type:t,formInline:d,formConfigs:N(t,p.value)},width:"75%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>x(M,{ref:n}),beforeSure:(c,{options:L})=>{const z=n.value.getRef(),O=L.props.formInline;z.validate(A=>{A&&F.confirm("确认要提交吗?","系统提示",{type:"warning",draggable:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then(()=>{B(t,i,O,()=>{c(),u()})}).catch(()=>{})})}})}catch{a.error("组织列表获取失败")}}const B=(t,e,s,i)=>{({add:K,edit:$})[t](s).then(c=>{if(c.status!==200)throw c.message;i(),a.success(`${e}成功`)}).catch(c=>{a.error(c||`${e}失败`)})};function I(t){j({id:t.id}).then(e=>{if(e.status!==200)throw e.message;a.success("删除成功"),u()}).catch(e=>{a.error("删除失败")})}return{formData:m,loading:g,columns:f,dataList:h,pagination:o,onSearch:u,resetForm:y,openDialog:C,handleDelete:I,handleSizeChange:k,handleCurrentChange:b,handleSelectionChange:D}}export{Q as useRole};
