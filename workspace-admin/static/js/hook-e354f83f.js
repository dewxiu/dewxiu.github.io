import{aF as x,r as m,S as E,h as J,aG as H,ab as O,aH as P,ar as B,m as f,a3 as F,a4 as S,q as I,F as V}from"./index-e18d8825.js";import Q from"./form-3eb1dc45.js";import{u as X,s as Y,a as Z}from"./common-10fe76a1.js";import{formConfigs as ee}from"./config-f9af059c.js";import te from"./Bpmn-a6ae7103.js";import"./regExp-b8203c09.js";import"./TitleCate-3b5df917.js";import"./sortable.esm-9c3c89c5.js";const ae=r=>x.request("post","/edit-table/list",{data:r}),le=r=>x.request("post","/test/add",{data:r}),oe=r=>x.request("post","/test/update",{data:r}),ne=r=>x.request("post","/test/delete",{data:r});function he(){const r=m(),M=E({name:""}),v=m(!0),T=m([]),C=m([]),q=X(".app-main .el-scrollbar",20+70+48),y=E({total:0,pageSize:20,small:!1,background:!0,align:"right",currentPage:1,pageSizes:[20,40,60]}),w=t=>{const e=m(-1),s=m(""),o=m(""),d=(a,n,l)=>{e.value=-1,t.value[n][a]=s.value,s.value},c=(a,n,l)=>{o.value=a,e.value=n,s.value=l},g=({row:a,column:n,index:l})=>{const u=n.property,b=e.value===l&&u===o.value;return f(V,null,[F(f(I("el-input"),{size:"small",modelValue:s.value,"onUpdate:modelValue":i=>s.value=i,onBlur:()=>d(u,l),onKeyup:i=>i.code==="Enter"&&c(u,l,a[u])},null),[[S,b]]),F(f("span",{onClick:()=>c(u,l,a[u]),class:"ui-w-100 ui-d-ib",style:{height:"24px"}},[a[u]]),[[S,!b]])])},R=[{label:"待处理",value:0},{label:"进行中",value:1},{label:"已处理",value:2},{label:"已完成",value:3}],D=({row:a,column:n,index:l,options:u})=>{const b={0:{name:"待处理",color:"#909399"},1:{name:"进行中",color:"#e6a23c"},2:{name:"已处理",color:"#409eff"},3:{name:"已完成",color:"#67c23a"},4:{name:"已失败",color:"#DC143C"}},i=n.property,z=e.value===l&&i===o.value,_={background:b[a[i]].color,height:"24px",lineHeight:"24px",color:"#fff",borderRadius:"4px"};return f(V,null,[F(f(I("el-select"),{size:"small",modelValue:s.value,"onUpdate:modelValue":p=>s.value=p,class:"ui-w-100",placeholder:"请选择",onBlur:()=>d(i,l),onChange:p=>c(i,l,p)},{default:()=>[u==null?void 0:u.map(p=>f(I("el-option"),{key:p.value,label:p.label,value:p.value},null))]}),[[S,z]]),F(f("span",{onClick:()=>c(i,l,a[i]),class:"ui-w-100 ui-d-ib",style:_},[b[a[i]].name]),[[S,!z]])])},k=[{label:"选择",prop:"title"},{label:"组织ID",prop:"id"},{label:"用户名(可编辑)",prop:"username",cellRenderer:({row:a,column:n,index:l})=>g({row:a,column:n,index:l})},{label:"年龄(可编辑)",prop:"age",cellRenderer:({row:a,column:n,index:l})=>g({row:a,column:n,index:l})},{label:"状态(下拉编辑)",prop:"state",cellRenderer:({row:a,column:n,index:l})=>D({row:a,column:n,index:l,options:R})},{label:"color",prop:"color"},{label:"desc",prop:"desc"},{label:"title",prop:"title"},{label:"money",prop:"money"},{label:"word",prop:"word"},{label:"borth",prop:"borth"},{label:"创建时间",prop:"createTime"},{label:"更新时间",prop:"updateTime"}];T.value=Y({columnData:k,showOpt:!0})};J(()=>{h()});async function h(){try{v.value=!0;const e=(await ae(M)).data;C.value=e,w(C),y.total=e.length,y.pageSize=100,y.currentPage=1,v.value=!1}catch{v.value=!1}}function re(t,e,s){}function L(t){}function N(t){}function U(t){}function j(t){}const $=()=>{Z([{dataList:C.value,columns:T.value,fileName:"表格数据"}])},A=t=>{t&&(t.resetFields(),h())};function W(t,e){const o={add:"添加",edit:"编辑"}[t],d={id:(e==null?void 0:e.id)??"",username:(e==null?void 0:e.username)??"",age:(e==null?void 0:e.age)??""};H({title:`${o}组织`,props:{formInline:d,formConfigs:ee(t)},width:"75%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>O(Q,{ref:r}),beforeSure:(c,{options:g})=>{const R=r.value.getRef(),D=g.props.formInline;R.validate(k=>{k&&P.confirm("确认要提交吗?","系统提示",{type:"warning",draggable:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then(()=>{G(t,o,D,()=>{c(),h()})}).catch(()=>{})})}})}const G=(t,e,s,o)=>{({add:le,edit:oe})[t](s).then(c=>{if(c.status!==200)throw c.message;o(),B(`${e}成功`,{type:"success"})}).catch(c=>{})};function K(t){ne({id:t.id}).then(e=>{B("删除成功",{type:"success"}),h()}).catch(e=>{})}return{formData:M,maxHeight:q,loading:v,columns:T,dataList:C,pagination:y,onSearch:h,resetForm:A,openDialog:W,handleDelete:K,onExport:$,openWorkFlow:({text:t})=>{H({title:"部署流程设计文件",props:{dataMsg:{dataMsg:666}},width:"640px",draggable:!0,fullscreen:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>O(te,{ref:r}),beforeSure:(e,{options:s})=>{const o=r.value.getRef();if(!o)return B("请保存模型",{type:"error"});P.confirm("确认提交吗","系统提示",{type:"warning",draggable:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then(()=>{const d=new FormData,c=`${o.name}.xml`,g=new File([o.data],c,{type:"text/xml"});d.append("files",g),d.append("deployName",o.name)}).catch(console.log)}})},handleSizeChange:L,onCurrentChange:j,handleCurrentChange:N,handleSelectionChange:U}}export{he as useTable};
